# Nixpacks build configuration for Railway (API server only)
# Dashboard deploys separately on Vercel

[phases.setup]
nixPkgs = ["nodejs_20"]
aptPkgs = []

[phases.install]
cmds = ["npm i -g pnpm@9 && pnpm install --frozen-lockfile"]

[phases.build]
cmds = [
  "pnpm --filter=@iron-gate/types build",
  "pnpm --filter=@iron-gate/config build",
  "pnpm --filter=@iron-gate/crypto build"
]

[start]
cmd = "cd apps/api && npx tsx src/index.ts"
